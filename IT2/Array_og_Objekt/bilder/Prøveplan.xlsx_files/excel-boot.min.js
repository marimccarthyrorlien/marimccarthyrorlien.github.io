var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Excel=function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/dist/",i(i.s=15)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.getApplicationBaseUrl=function(e){var t=e.indexOf("/",8);if(t<0)throw new Error("URL should contain a / after domain");var i=e.indexOf("/",t+1);if(i>=0)return e.substr(0,i+1);throw new Error("URL should contain a / after domain and folder")},e.getParameterValue=function(e,t){var i=e.indexOf("&"+t+"=");if(-1===i&&(i=e.indexOf("?"+t+"=")),-1===i)return"";var o=i+(t.length+2),n=e.indexOf("&",o);return-1===n?e.substr(o):e.substring(o,n)},e.getOrigin=function(e){return e.replace(/^(.*\/\/[^\/?#]*).*$/,"$1")},e.addQueryParam=function(e,t,i){if(!i)return e;var o=e,n=o.indexOf("?"),a="&";return n===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?a="":-1===n&&(a="?"),"&"===a&&o.indexOf(t+"=",n)>=0?o:o.concat(a,t,"=",i)},e.getBaseDomain=function(e,t){var i=document.createElement("a");if(i.setAttribute("href",e),!i.hostname)throw new Error("Invalid URL. Cannot find domain");if(void 0===t)return i.hostname;if(t<0)throw new Error("subDomainParts should be at least 1");return i.hostname.split(".").slice(-(t+1)).join(".")},e.getApplicationUrl=function(t,i,o,n){var a=e.getOrigin(t);if(a=a.replace("onenote",i),a+=o+"?",n)for(var r in n)a=e.addQueryParam(a,r,n[r]),a+="&";return a.concat("<ui=UI_LLCC&><rs=DC_LLCC&><dchat=DISABLE_CHAT&><hid=HOST_SESSION_ID&><showpagestats=PERFSTATS&><IsLicensedUser=BUSINESS_USER&><actnavid=ACTIVITY_NAVIGATION_ID&>")},e}();t.UrlUtils=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(4);t.logCategory=o.logCategory;var n=i(5);t.logLevel=n.logLevel;var a=i(17),r=i(18);t.ULS={getLogger:function(e,t){var i=new r.bUlsCache(e,t);return{ULS:{trace:function(e,t,o){return l(i,0,e,t,o)},traceTag:function(e,t,o,n){return l(i,e,t,o,n)},flush:i.flush,flushOnClose:i.flushOnClose}}}};var s=n.logLevel.Info;function l(e,t,i,o,n){if(!(o>s)){var r={timestamp:Date.now(),category:i,tag:t,level:o,type:a.logType.Trace,message:n};e.handleTrace(r)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return Object.defineProperty(e,"BUILD_NUMBER",{get:function(){return "16.0.11319.35052"},enumerable:!0,configurable:!0}),e}();t.BuildVersionConfig=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return Object.defineProperty(e,"Unknown",{get:function(){return"Unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AppInitError",{get:function(){return"AppInitError"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ApiDisabledError",{get:function(){return"ApiDisabledError"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CannotLoadFirstPage",{get:function(){return"CannotLoadFirstPage"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CannotLoadScript",{get:function(){return"CannotLoadScript"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PageChangeError",{get:function(){return"PageChangeError"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ZoomChangeError",{get:function(){return"ZoomChangeError"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CannotLoadBundleItem",{get:function(){return"CannotLoadBundleItem"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"InvalidPageIndex",{get:function(){return"InvalidPageIndex"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UnsupportedBundleVersion",{get:function(){return"UnsupportedBundleVersion"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"InvalidWopiInfo",{get:function(){return"InvalidWopiInfo"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TimeoutWacReady",{get:function(){return"TimeoutWacReady"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WacFailed",{get:function(){return"WacFailed"},enumerable:!0,configurable:!0}),e}();t.ApplicationErrors=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ExcelEwaJs=0]="ExcelEwaJs",e[e.WordViewer=301]="WordViewer",e[e.WopiPendingApplication=379]="WopiPendingApplication",e[e.VisioApp=700]="VisioApp",e[e.PptSession=817]="PptSession"}(t.logCategory||(t.logCategory={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Spam=200]="Spam",e[e.Verbose=100]="Verbose",e[e.Info=50]="Info",e[e.Warning=15]="Warning",e[e.Error=10]="Error"}(t.logLevel||(t.logLevel={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),n=function(){function e(){}return e.createWacFrame=function(e,t,i,n,a){var r=e.ownerDocument.createElement("iframe");r.name=n||"WebApplicationFrame",r.id="WebApplicationFrame",r.src="",r.title="Office Online Frame",r.width="100%",r.height="100%",r.marginWidth="0",r.marginHeight="0",r.style.left="0",r.style.top="0",r.style.right="0",r.style.bottom="0",r.style.display="block",r.style.position="absolute",r.style.backgroundColor="transparent",r.style.border="none",r.frameBorder="0",r.setAttribute("allowfullscreen","true"),r.setAttribute("allowTransparency","true"),i&&r.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation allow-popups-to-escape-sandbox");var s=o.UrlUtils.getOrigin(t);return r.setAttribute("allow","microphone "+s),a&&(r.onload=a),e.appendChild(r),r},e.createAndSubmitWacFrame=function(t,i,o,n,a){var r=e.createWacFrame(t,i,n,a);return e.submitWacFrame(r,t,i,o)},e.submitWacFrame=function(t,i,o,n){e.AddFrameDimensionsToPostData(t,n);var a=i.ownerDocument,r=a.createElement("form");for(var s in r.id="office_form",r.name="office_form",r.action=o,r.target=t.name,r.method="POST",n){var l=a.createElement("input");l.name=s,l.value=n[s],l.type="hidden",r.appendChild(l)}return i.appendChild(r),r.submit(),t},e.AddFrameDimensionsToPostData=function(t,i){i[e.wacFrameComputedHeightPx]=String(t.offsetHeight),i[e.wacFrameComputedWidthPx]=String(t.offsetWidth)},e.wacReadyTimeoutInMs=5e3,e.completeOrFailTimeoutInMs=5e3,e.wacAppCompleteOrFailTimeoutInMs=15e3,e.postMessageMaxRetries=3,e.wacSessionCompleteAckTimeoutInMs=1e3,e.subDomainPartsForPostMessageHandler=2,e.wacFrameAccessToken="access_token",e.wacFrameAccessTokenTtl="access_token_ttl",e.wacFrameBundleSource="bundleSrc",e.wacFrameFileGetUrl="fileGetUrl",e.wacFrameFileExtension="fileExtension",e.wacFrameOwnerId="owner_id",e.wacFrameUserId="user_id",e.wacFrameSessionContext="sc",e.wacFrameHostDiagnostics="host_diagnostics",e.wacFrameHighDpi="highDpi",e.wacFrameComputedHeightPx="frameHeightPx",e.wacFrameComputedWidthPx="frameWidthtPx",e.wacFrameHostFlights="hostFlights",e.fromWacFrameInitReady="WacInitialize_Ready",e.fromWacFrameInitFrameLoaded="WacInitialize_FrameLoaded",e.fromWacFrameAppCompleted="Wac_AppCompleted",e.fromWacFrameAppCompletedAck="Wac_AppCompleted_Ack",e.fromWacFrameAppLoadingStatus="App_LoadingStatus",e.fromWacFrameAppFailed="Wac_AppFailed",e.fromWacFrameAppFailedAck="Wac_AppFailed_Ack",e.fromWacFrameSessionCompleteAck="WopiSession_Complete_Ack",e.toWacFrameFailSession="WopiPendingSession_Fail",e.toWacFrameInitReadyAck="WacInitialize_Ready_Ack",e.toWacFramePendingSessionComplete="WopiPendingSession_Complete",e.toWacFrameStartSessionComplete="WopiStartSession_Complete",e.toWacFrameJsApiDiagnostics="JsApiDiagnostics",e.toWacFramePendingAppCompleteReceived="WopiPendingApplicationComplete_Received",e}();t.OfficeFrameUtils=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(4),n=function(){function e(e){this.sessionTraces={},this.logger=e}return e.prototype.add=function(e,t){this.sessionTraces[e]=t},e.prototype.get=function(e){return this.sessionTraces[e]},e.prototype.log=function(e){this.logger.ULS.traceTag(596459999,o.logCategory.WopiPendingApplication,e,"sessionTraces:"+JSON.stringify(this.sessionTraces))},e.prototype.stringify=function(){return JSON.stringify(this.sessionTraces)},e.wopiInitializeTime="wopiInitializeTime",e.wopiPendingInitializeTime="wopiPendingInitializeTime",e.wopiPendingCompleteTime="wopiPendingCompleteTime",e.startSessionStartTime="startSessionStartTime",e.startSessionCompleteTime="startSessionCompleteTime",e.readyMessageReceiveTime="readyMessageReceiveTime",e.completeMessageSendTime="completeMessageSendTime",e.completeMessageCreateTime="completeMessageCreateTime",e}();t.SessionTraces=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),n=i(1),a=i(9),r=i(0),s=i(6),l=i(7),c=i(21),p=i(2),g=function(){function e(e,t,i,o,n,a,r,c,p){var g=this;this.wacFrameIsLoaded=!1,this.initializeCompleted=!1,this.completeOrFailCalled=!1,this.sessionFailureReason=null,this.parallelizeStartSession=!0,this.wacAcceptsStartSessionComplete=!1,this.wacAppSessionCompletionMessageAck=!1,this.appParams=e,this.wopiFallbackInfo=t,this.appInitDiagnostics=i,this.logger=o,this.postMessenger=n,this.visibilityMetrics=a,this.fnOnWopiBootSuccess=c,this.fnOnWopiBootFailure=p,this.sessionTraces=r,this.sessionTraces.add(l.SessionTraces.wopiPendingInitializeTime,Date.now()),this.setTimeout(function(){return g.timeoutCompleteOrFail()},s.OfficeFrameUtils.completeOrFailTimeoutInMs)}return e.prototype.Complete=function(e,t){if(this.completeOrFailCalled)this.logger.ULS.traceTag(596444184,n.logCategory.WopiPendingApplication,n.logLevel.Warning,"Complete called after Complete/Fail already called");else{this.logger.ULS.traceTag(596444185,n.logCategory.WopiPendingApplication,n.logLevel.Info,"WopiPendingApplication.Complete() called."),this.completeOrFailCalled=!0,this.wopiInfo=e,this.sessionTraces.add(l.SessionTraces.wopiPendingCompleteTime,Date.now());try{this.wopiFallbackInfo.required?this.completeFallbackFlow():this.completeInstantFlow(),this.wacFrameIsLoaded&&this.sendWacPostMessage(s.OfficeFrameUtils.toWacFramePendingAppCompleteReceived,{}),this.updateBrowserHistoryForCreateNew(t)}catch(e){this.logger.ULS.traceTag(596444186,n.logCategory.WopiPendingApplication,n.logLevel.Error,"WopiPendingApplication.Complete() unexpected script error: "+(e?e.message:"N/A"))}this.logger.ULS.flush()}},e.prototype.Fail=function(e){this.completeOrFailCalled?this.logger.ULS.traceTag(596444187,n.logCategory.WopiPendingApplication,n.logLevel.Warning,"Fail called after Complete/Fail already called"):(this.logger.ULS.traceTag(596444188,n.logCategory.WopiPendingApplication,n.logLevel.Warning,"WopiPendingApplication.Fail() called. Reason: "+(e?JSON.stringify(e):"N/A")),this.completeOrFailCalled=!0,this.wopiFallbackInfo.required?this.failFallbackFlow():this.failInstantFlow(e),this.logger.ULS.flush())},e.prototype.Boot=function(){this.wopiFallbackInfo.required||this.bootInstantFlow(),this.logger.ULS.flush()},e.prototype.bootInstantFlow=function(){var e=this;this.logger.ULS.traceTag(596444231,n.logCategory.WopiPendingApplication,n.logLevel.Info,"Initializing Office frame WITHOUT WOPI info available - first step of instant boot flow."),this.setTimeout(function(){return e.timeoutWacReadyMessage()},s.OfficeFrameUtils.wacReadyTimeoutInMs),this.populateWacFrameEventHandlersForInstantBoot();var t=new c.WopiApplicationInitializer(this.appParams,this.wopiFallbackInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.visibilityMetrics,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=t.Boot()},e.prototype.populateWacFrameEventHandlersForInstantBoot=function(){var e=this;this.postMessenger.RegisterMessagePayloadHandler(s.OfficeFrameUtils.fromWacFrameInitReady,function(t){e.handleWacReadyMessage(t)}),this.postMessenger.RegisterMessagePayloadHandler(s.OfficeFrameUtils.fromWacFrameInitFrameLoaded,function(t){e.handleWacFrameLoadedMessage(t)}),this.postMessenger.RegisterMessagePayloadHandler(s.OfficeFrameUtils.fromWacFrameSessionCompleteAck,function(t){e.handleWacFrameSessionCompleteAckMessage(t)})},e.prototype.completeInstantFlow=function(){var e={ParallelizeStartSession:this.parallelizeStartSession,WacFrameIsLoaded:this.wacFrameIsLoaded,WacAcceptsStartSessionComplete:this.wacAcceptsStartSessionComplete};this.logger.ULS.traceTag(596444232,n.logCategory.WopiPendingApplication,n.logLevel.Info,"Completing the Office initialized application WITH the WOPI info - second step of instant boot flow. Current app state - "+JSON.stringify(e)),!this.parallelizeStartSession||this.wacFrameIsLoaded&&!this.wacAcceptsStartSessionComplete?this.wacFrameIsLoaded&&this.sendWopiInfoToWacFrame():this.makeStartSessionRequest()},e.prototype.completeFallbackFlow=function(){this.logger.ULS.traceTag(596444233,n.logCategory.WopiPendingApplication,n.logLevel.Info,"Initializing Office frame WITH WOPI info available - single step of WOPI boot flow."),this.appParams.wopiInfo=this.wopiInfo;var e=new c.WopiApplicationInitializer(this.appParams,this.wopiFallbackInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.visibilityMetrics,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=e.Boot()},e.prototype.failInstantFlow=function(e){this.wacFrameIsLoaded?(this.logger.ULS.traceTag(595968481,n.logCategory.WopiPendingApplication,n.logLevel.Warning,"Fail called and wacframe is able to accept postmessages"),this.sendFailurePostMessageToWacFrame(e)):(this.logger.ULS.traceTag(595968482,n.logCategory.WopiPendingApplication,n.logLevel.Warning,"Fail was called on the session prior to WacReady."),this.sessionFailureReason=e)},e.prototype.sendFailurePostMessageToWacFrame=function(e){this.logger.ULS.traceTag(596444189,n.logCategory.WopiPendingApplication,n.logLevel.Warning,"Fail called, sending the failure postmessage to IFrame"),this.sendWacPostMessage(s.OfficeFrameUtils.toWacFrameFailSession,e)},e.prototype.failFallbackFlow=function(){this.logger.ULS.traceTag(596444190,n.logCategory.WopiPendingApplication,n.logLevel.Warning,"Fail called during Fallback Boot, calling host failure callback..."),this.fnOnWopiBootFailure({errorType:o.ApplicationErrors.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},e.prototype.setTimeout=function(e,t){window.setTimeout(function(){return e()},t)},e.prototype.timeoutWacReadyMessage=function(){this.wacFrameIsLoaded||(this.logger.ULS.traceTag(596444191,n.logCategory.WopiPendingApplication,n.logLevel.Warning,"WopiPendingApplication.timeoutWacReadyMessage()"),this.fnOnWopiBootFailure({errorType:o.ApplicationErrors.TimeoutWacReady,errorObject:void 0}))},e.prototype.timeoutCompleteOrFail=function(){this.completeOrFailCalled||(this.logger.ULS.traceTag(596444192,n.logCategory.WopiPendingApplication,n.logLevel.Warning,"WopiPendingApplication.timeoutCompleteOrFail() sessionTraces:"+this.sessionTraces.stringify()),this.sessionTraces.add("timeoutCompleteOrFail",Date.now()))},e.prototype.timeoutWacSessionCompletionMessageAck=function(e,t,i){this.wacAppSessionCompletionMessageAck||(this.logger.ULS.traceTag(596444193,n.logCategory.WopiPendingApplication,n.logLevel.Info,"SessionCompletion timed out with no ack."),this.sendSessionCompletionMessageWithRetryHelper(e,t,i+1))},e.prototype.handleWacReadyMessage=function(e){if(this.sessionTraces.add(l.SessionTraces.readyMessageReceiveTime,Date.now()),this.sendWacPostMessage(s.OfficeFrameUtils.toWacFrameInitReadyAck,{}),this.wacFrameIsLoaded)this.logger.ULS.traceTag(596444194,n.logCategory.WopiPendingApplication,n.logLevel.Info,"Received multiple ready messages - frame is already loaded.");else{this.wacFrameIsLoaded=!0,this.wacAcceptsStartSessionComplete=e&&e.CanAcceptStartSessionComplete;var t={AcceptStartSessionComplete:this.wacAcceptsStartSessionComplete,ParallelizeStartSession:this.parallelizeStartSession,StartSessionResponse:null!=this.startSessionResponse,WopiInfo:null!=this.wopiInfo};this.logger.ULS.traceTag(596444195,n.logCategory.WopiPendingApplication,n.logLevel.Info,"HandleWacReadyMessage - "+JSON.stringify(t)),this.completeOrFailCalled&&(this.sessionFailureReason?this.sendFailurePostMessageToWacFrame(this.sessionFailureReason):this.sendWacPostMessage(s.OfficeFrameUtils.toWacFramePendingAppCompleteReceived,{})),this.parallelizeStartSession&&this.wacAcceptsStartSessionComplete?this.startSessionResponse&&this.startSessionCompleted():this.wopiInfo&&this.sendWopiInfoToWacFrame(),a.DiagnosticsHelper.assembleFromMessagePayload(e,this.appInitDiagnostics)}},e.prototype.handleWacFrameLoadedMessage=function(e){a.DiagnosticsHelper.assembleFromMessagePayload(e,this.appInitDiagnostics)},e.prototype.handleWacFrameSessionCompleteAckMessage=function(e){this.wacAppSessionCompletionMessageAck=!0,this.sessionTraces.add("sessionCompleteAckReceivedTime",Date.now())},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.postMessenger.SendPostMessage(this.innerApplicationFrame.contentWindow,e,t)},e.prototype.sendSessionCompletionMessageWithRetry=function(e,t){this.sendSessionCompletionMessageWithRetryHelper(e,t,1)},e.prototype.sendSessionCompletionMessageWithRetryHelper=function(e,t,i){var o=this;if(i>s.OfficeFrameUtils.postMessageMaxRetries)this.logger.ULS.traceTag(596444224,n.logCategory.WopiPendingApplication,n.logLevel.Error,"Attempted to call complete, but received no ack from the frame. Time: "+Date.now());else{this.logger.ULS.traceTag(596444225,n.logCategory.WopiPendingApplication,n.logLevel.Info,"Sending completion message to frame. Attempt number: "+i+", Time: "+Date.now());var a=Date.now();1===i&&(this.startSessionResponse&&this.startSessionResponse.Diagnostics&&(this.startSessionResponse.Diagnostics.completeMessageCreateTime=a),this.sessionTraces.add(l.SessionTraces.completeMessageCreateTime,a)),t.Diagnostics.completeMessageSendTime=a,this.sessionTraces.add(l.SessionTraces.completeMessageSendTime,a),this.sendWacPostMessage(e,t),this.setTimeout(function(){return o.timeoutWacSessionCompletionMessageAck(e,t,i)},s.OfficeFrameUtils.wacSessionCompleteAckTimeoutInMs)}},e.prototype.makeStartSessionRequest=function(){var t=this;this.logger.ULS.traceTag(596444226,n.logCategory.WopiPendingApplication,n.logLevel.Info,"Making parallelized startSession request.");var i=this.buildStartSessionUrl(this.wopiInfo),o={"Content-Type":"application/x-www-form-urlencoded"},a="access_token="+encodeURIComponent(this.wopiInfo.AccessToken)+"&access_token_ttl="+encodeURIComponent(c.WopiApplicationInitializer.getAccessTokenTtl(this.wopiInfo));this.sessionTraces.add(l.SessionTraces.startSessionStartTime,Date.now()),e.makeXhrRequest(i,a,o,function(e){return t.onStartSessionRequestCompleted(e)})},e.prototype.onStartSessionRequestCompleted=function(e){if(this.sessionTraces.add(l.SessionTraces.startSessionCompleteTime,Date.now()),this.sessionTraces.add("startSessionResponseStatus",e.status),this.startSessionResponse={StartSessionResponse:{RequestStatus:e.status,ResponseText:e.responseText},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.get(l.SessionTraces.wopiPendingInitializeTime),wopiPendingCompleteTime:this.sessionTraces.get(l.SessionTraces.wopiPendingCompleteTime),startSessionStartTime:this.sessionTraces.get(l.SessionTraces.startSessionStartTime),startSessionCompleteTime:this.sessionTraces.get(l.SessionTraces.startSessionCompleteTime),readyMessageReceiveTime:this.sessionTraces.get(l.SessionTraces.readyMessageReceiveTime)}},this.logger.ULS.traceTag(596444227,n.logCategory.WopiPendingApplication,n.logLevel.Info,"StartSession request completed with status code: "+this.startSessionResponse.StartSessionResponse.RequestStatus+", Time: "+Date.now()),this.wacFrameIsLoaded&&this.wacAcceptsStartSessionComplete)this.startSessionCompleted();else{var t={WacFrameIsLoaded:this.wacFrameIsLoaded,InitializeCompleted:this.initializeCompleted};this.logger.ULS.traceTag(596444228,n.logCategory.WopiPendingApplication,n.logLevel.Info,"StartSessionCompleted not called - "+JSON.stringify(t))}},e.prototype.sendWopiInfoToWacFrame=function(){if(!this.initializeCompleted){this.initializeCompleted=!0,this.logger.ULS.traceTag(596444229,n.logCategory.WopiPendingApplication,n.logLevel.Info,"Sending wopi info to the frame.");var e={WopiDetails:{WopiSrc:this.wopiInfo.WopiSrc,AccessToken:this.wopiInfo.AccessToken,AccessTokenTtl:c.WopiApplicationInitializer.getAccessTokenTtl(this.wopiInfo)},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.get(l.SessionTraces.wopiPendingInitializeTime),wopiPendingCompleteTime:this.sessionTraces.get(l.SessionTraces.wopiPendingCompleteTime),readyMessageReceiveTime:this.sessionTraces.get(l.SessionTraces.readyMessageReceiveTime)}};this.sendSessionCompletionMessageWithRetry(s.OfficeFrameUtils.toWacFramePendingSessionComplete,e)}},e.prototype.startSessionCompleted=function(){200===this.startSessionResponse.StartSessionResponse.RequestStatus?this.initializeCompleted||(this.initializeCompleted=!0,this.sendSessionCompletionMessageWithRetry(s.OfficeFrameUtils.toWacFrameStartSessionComplete,this.startSessionResponse)):this.sendWopiInfoToWacFrame()},e.prototype.buildStartSessionUrl=function(t){var i=this.appParams.applicationBaseUrl+e.wordEditorStartSessionName,o=c.WopiApplicationInitializer.buildApplicationBootUrl(this.appParams,this.wopiFallbackInfo,!1);return i+="?"+o.substring(o.indexOf("?")+1),i=r.UrlUtils.addQueryParam(i,"WOPISrc",encodeURIComponent(t.WopiSrc)),i=r.UrlUtils.addQueryParam(i,"build",encodeURIComponent(p.BuildVersionConfig.BUILD_NUMBER)),i=r.UrlUtils.addQueryParam(i,"WacUserType",encodeURIComponent("WOPI")),this.appParams.wopiPrecheckInfo.FileGetUrl&&(i=r.UrlUtils.addQueryParam(i,"fileGetUrlPresent","1")),i},e.prototype.updateBrowserHistoryForCreateNew=function(e){if(this.appParams.isCreateNew){if(!e||!e.NewFilePath)return void this.logger.ULS.traceTag(596444230,n.logCategory.WopiPendingApplication,n.logLevel.Error,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",e.NewFilePath),e.UpdatedPageTitle&&(document.title=e.UpdatedPageTitle)}},e.makeXhrRequest=function(e,t,i,o){var n=new XMLHttpRequest,a=t||"";for(var r in n.onreadystatechange=function(){if(n&&4===n.readyState){if(void 0===n.status||0===n.status)return;try{o&&o(n)}finally{null!=n&&(n.onreadystatechange=function(){})}}},n.open("Post",e,!0),i)n.setRequestHeader(r,i[r]);n.send(a)},e.wordEditorStartSessionName="wordeditorstartsession.ashx",e}();t.WopiPendingApplicationInitializer=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.assembleFromMessagePayload=function(e,t){if(e&&e.Diagnostics){var i=e.Diagnostics;for(var o in i)t[o]=i[o]}},e}();t.DiagnosticsHelper=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebugConfig={DEBUG_SUFFIX:"",IS_DEBUG:!1,MIN_SUFFIX:".min"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.unifiedSingleFlushFallback="Unified_SingleFlushFallback",e.unifiedIrmEnabledFallback="Unified_IrmEnabled",e.unifiedViewActionUrlFallback="Unified_ViewActionUrl",e.unifiedNotEditOrViewActionUrlFallback="Unified_NotEditOrViewActionUrl",e.forceFallback="Force_Fallback"}(t.FallbackOptions||(t.FallbackOptions={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(1),n=i(0),a=i(32),r=function(){function e(){this.flights={},this.AddFlights()}return e.Instance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.IsFlightEnabled=function(e){return this.flights[e]&&this.flights[e].IsFlightEnabled()},e.prototype.AddFlights=function(){var e=a.FlightList;this.AddFlightsToDictionary(e)},e.prototype.AddFlightsToDictionary=function(e){var t=this;e.forEach(function(e){t.flights[e.name]=e,n.UrlUtils.getParameterValue(window.location.href,"jsApiTf")===e.name&&e.ForceEnable()})},e.prototype.GetFlights=function(){return this.flights},e.LogFlights=function(e,t){e.ULS.traceTag(595914759,o.logCategory.WopiPendingApplication,o.logLevel.Info,void 0===t?"NoFlights":JSON.stringify(t))},e}();t.FlightManager=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(14);t.ExcelFlightsList=[new o.Flight("ExcelEwaBootScript",0,!1),new o.Flight("ExcelGridRendererDownload",.5,!0)]},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,i){this.name=e,this.exposure=t;var o=Math.random();this.isTreatment=o<t,this.isControl=t<=.5&&1-o<t,this.shouldPassStatusToWacFrame=!0===i}return e.prototype.IsFlightEnabled=function(){return this.isTreatment},e.prototype.ForceEnable=function(){this.isTreatment=!0,this.isControl=!1},e.prototype.IsFlightControl=function(){return this.isControl},e}();t.Flight=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(16),n=i(34),a=i(35),r=i(13);t.Application=new o.ApplicationBootstrapper(n.ApplicationFactory,{forceFallback:!0,preloader:new a.ExcelPreloader,flights:r.ExcelFlightsList})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(8),n=i(24),a=i(3),r=i(27),s=i(1),l=i(2),c=i(0),p=i(28),g=i(7),d=i(29),u=i(11),f=i(12),m=function(){function e(e,t){this.appFactory=e,this.bootstrapperParameters=t}return e.prototype.GetVersion=function(){return l.BuildVersionConfig.BUILD_NUMBER},e.prototype.GetMinContentVersion=function(){throw new Error("Not implemented")},e.prototype.Prefetch=function(e){if(null!=e&&void 0!==e){var t=document.createElement("link");t.rel="prefetch";var i=e.BootstrapperUrl;".js"!==i.toString().slice(-3)&&(i+=".js"),t.href=i;var o=document.getElementsByTagName("head")[0];null!=o&&void 0!==o&&o.appendChild(t)}},e.prototype.InitializeWopiPending=function(t,i,m,h){var y;try{var P=Date.now();e.validateParametersWopiPending(t);var v=m,F=void 0;v||(v=(y=d.newGuid())[0],F=y[1]);var b=d.getApplicationParameters(t,v);b.flights=this.bootstrapperParameters.flights,this.bootstrapperParameters.fnReportSessionStart&&this.bootstrapperParameters.fnReportSessionStart(b),b.forceFallback=this.bootstrapperParameters.forceFallback,b.fnCreatePragueFrame=this.bootstrapperParameters.fnCreatePragueFrame,b.diagnostics.HostInitializeDiagnostics&&(b.diagnostics.HostInitializeDiagnostics.hostInitializeCallTime=P);var C=i||s.ULS.getLogger(b.sessionId,b.applicationBaseUrl+"RemoteUls.ashx");C.ULS.traceTag(596464283,s.logCategory.WopiPendingApplication,s.logLevel.Info,"ApplicationBootstrapper - initializing session. Build version: "+this.GetVersion()),F&&C.ULS.traceTag(595937313,s.logCategory.WopiPendingApplication,s.logLevel.Info,JSON.stringify(F)),window.addEventListener("beforeunload",function(){C&&(C.ULS.traceTag(595957843,s.logCategory.WopiPendingApplication,s.logLevel.Info,"OnBeforeUnload fired. Flushing ULS logger."),C.ULS.flush())}),b.diagnostics.JsApiDiagnostics.flights=f.FlightManager.Instance().GetFlights(),f.FlightManager.LogFlights(C,b.flights);var S=JSON.parse(JSON.stringify(b.sessionInformation));delete S.UserId,delete S.OwnerId,C.ULS.traceTag(596444237,s.logCategory.WopiPendingApplication,s.logLevel.Info,JSON.stringify({hostSessionInformation:S})),C.ULS.traceTag(596444238,s.logCategory.WopiPendingApplication,s.logLevel.Info,JSON.stringify({hostInitDiagnostics:b.diagnostics.HostInitializeDiagnostics?b.diagnostics.HostInitializeDiagnostics:"N/A"})),this.logFlightInfo(b,C);var w=c.UrlUtils.getOrigin(b.fnCreatePragueFrame?window.location.href:t.ApplicationUrl),I=h||new r.PostMessageHandler(w,C),U=new p.WindowVisibilityMetrics,W=new g.SessionTraces(C),A=d.getWopiFallbackInfo(b,C),T={officeSessionId:b.sessionId,officeBootstrapperVersion:l.BuildVersionConfig.BUILD_NUMBER,hostName:b.sessionInformation.HostName},O=e.getSuccessCallback(T,b.sessionId,I,C,W,U,t.FnOnInitializeSuccess,this.appFactory),M=e.getFailureCallback(T,C,W,U,t.FnOnInitializeFailure),L=void 0;if(this.bootstrapperParameters.useViewerInitializer||A.reason===u.FallbackOptions.unifiedViewActionUrlFallback)L=new n.WordViewerInitializer(b,A,T,C,I,U,W,O,M);else{var E=t&&t.BootstrapperUrl,R=A.required?A.applicationUrl:b.applicationUrl;if(E&&this.bootstrapperParameters.preloader&&this.bootstrapperParameters.preloader.shouldPreload(R))try{this.bootstrapperParameters.preloader.preload(E)}catch(e){C.ULS.traceTag(595943884,s.logCategory.WopiPendingApplication,s.logLevel.Error,JSON.stringify(e))}L=new o.WopiPendingApplicationInitializer(b,A,T,C,I,U,W,O,M)}return L.Boot(),L}catch(e){return i&&(i.ULS.traceTag(596459925,s.logCategory.WopiPendingApplication,s.logLevel.Error,a.ApplicationErrors.AppInitError+": "+JSON.stringify(e)),i.ULS.flushOnClose()),void t.FnOnInitializeFailure({errorType:a.ApplicationErrors.AppInitError,errorObject:e},void 0)}},e.prototype.logFlightInfo=function(e,t){var i=e.applicationCustomSettings&&e.applicationCustomSettings.InteractiveReadOnlyFlight,o=e.applicationCustomSettings&&e.applicationCustomSettings.InteractiveReadOnlyAAExperiment;i&&t.ULS.traceTag(595953632,s.logCategory.WopiPendingApplication,s.logLevel.Warning,"InteractiveReadOnlyFlight: "+i+", InteractiveReadOnlyAAExperiment: "+o)},e.getSuccessCallback=function(t,i,o,n,a,r,l,c){return function(p){e.traceTabSwitchDiagnostics(t,a,r),a.log(s.logLevel.Info),n.ULS.traceTag(596448985,s.logCategory.WopiPendingApplication,s.logLevel.Info,JSON.stringify(t));var g=c(i,n,o,p);l(g,t),e.TraceJsapiResourceTiming(n)}},e.getFailureCallback=function(t,i,o,n,a){return function(r){e.traceTabSwitchDiagnostics(t,o,n),o.log(s.logLevel.Warning),i.ULS.traceTag(596448986,s.logCategory.WopiPendingApplication,s.logLevel.Error,JSON.stringify({error:r,appInitDiagnostics:t})),a(r,t),e.TraceJsapiResourceTiming(i)}},e.TraceJsapiResourceTiming=function(t){try{if(void 0===window.performance)return void t.ULS.traceTag(595948609,s.logCategory.WopiPendingApplication,s.logLevel.Info,"ApplicationBootstrapper.TraceJsapiResourceTiming: performance not supported");var i=window.performance.getEntriesByType("resource");if(void 0===i||i.length<=0)return void t.ULS.traceTag(595948610,s.logCategory.WopiPendingApplication,s.logLevel.Info,"ApplicationBootstrapper.TraceJsapiResourceTiming: no resources under performance");for(var o=0,n=i;o<n.length;o++){var a=n[o];if(e.bootstrapperURLRegex.test(a.name))return void t.ULS.traceTag(595948616,s.logCategory.WopiPendingApplication,s.logLevel.Info,JSON.stringify(a))}t.ULS.traceTag(595948484,s.logCategory.WopiPendingApplication,s.logLevel.Info,"ApplicationBootstrapper.TraceJsapiResourceTiming: could not find JSAPI resource timing entry")}catch(e){t.ULS.traceTag(595948617,s.logCategory.WopiPendingApplication,s.logLevel.Info,"ApplicationBootstrapper.TraceJsapiResourceTiming: could not trace the resource timing, error is: "+JSON.stringify(e))}},e.traceTabSwitchDiagnostics=function(e,t,i){i.Stop();var o=i.GetVisibilityChangeEvents();null!=o&&o.length>0&&(e.documentLoadedWithTabSwitch=!0,t.add("tabSwitchDiagnostics",JSON.stringify(o)))},e.validateParametersWopiPending=function(e){if(void 0===e)throw new TypeError("initParams");var t=e.Container;if(void 0===t||void 0===t.appendChild)throw new TypeError("Container");var i=e.SessionInformation;if(void 0===i||void 0===i.HostName||void 0===i.HostSessionId||void 0===i.UserId)throw new TypeError("SessionInformation");var o=e.ApplicationUrl;if(void 0===o||"string"!=typeof o)throw new TypeError("ApplicationUrl");var n=e.WopiPrecheckInfo;if(void 0===n||void 0===n.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===e.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===e.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")},e.bootstrapperURLRegex=new RegExp("excel-boot.min.js|word.boot.js|visio.boot.js","i"),e}();t.ApplicationBootstrapper=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(t.logType||(t.logType={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(5),n=i(19),a=i(20),r=function(){function e(t,i){var o=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){o.triggerUpload(!1,!1)},this.flush=function(){o.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout(function(){return o.triggerUpload(!0,!0)},0)},this.triggerUpload=function(t,i){if(window.clearTimeout(o.timeoutId),o.logCache.length>0){o.uploadId+=1;var r=a.formatForUpload(o.logCache,o.userSessionId,o.uploadId,o.timestampBase);n.uploadLogs(r,o.remoteUrlEndpoint,i),o.logCache=[],o.timestampBase=Date.now()}t&&(o.timeoutId=window.setTimeout(o.triggerUploadAsync,e.uploadCadenceInMsSec))},this.userSessionId=t,this.remoteUrlEndpoint=i+"?usid="+t,window.setTimeout(function(){return o.triggerUpload(!0,!0)},0)}return e.prototype.handleTrace=function(t){t.message.length>e.messageMaxChars&&(t.message=t.message.substr(0,e.messageMaxChars-e.trimedMessage.length)+e.trimedMessage),this.logCache.push(t),(this.logCache.length>e.uploadTriggerSize||t.level===o.logLevel.Error)&&this.triggerUploadAsync()},e.messageMaxChars=3072,e.uploadCadenceInMsSec=3e4,e.uploadTriggerSize=30,e.trimedMessage="... [Trimmed]",e}();t.bUlsCache=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadLogs=function(e,t,i){if(""!==t){var o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",t,i),o.send(e))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatForUpload=function(e,t,i,n){var a=e.map(function(e){return function(e,t){var i={};i.G=e.tag,i.T=e.timestamp-t,i.M=e.message,i.C=e.category;var n=e.type*o+e.level;return i.D=n,i}(e,n)}),r=function(e,t,i,o){var n={};return n.T=e,n.L=t,n.S=i,n.I=o,n.V=1,n}(n,a,t,i);return JSON.stringify(r)};var o=1e3},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(1),n=i(9),a=i(0),r=i(22),s=i(6),l=i(7),c=i(3),p=i(23),g=function(){function e(e,t,i,o,n,a,r,s,c){if(this.wacAppCompleteOrFailReceived=!1,void 0===t)throw new TypeError("wopiFallbackInfo");if(t.required&&void 0===e.wopiInfo)throw new TypeError("wopiInfo");this.appParams=e,this.wopiFallbackInfo=t,this.logger=n,this.postMessenger=a,this.visibilityMetrics=r,this.fnOnWopiBootSuccess=s,this.fnOnWopiBootFailure=c,this.appInitDiagnostics=i,this.sessionTraces=o,this.sessionTraces.add(l.SessionTraces.wopiInitializeTime,Date.now())}return e.prototype.Boot=function(){this.logger.ULS.traceTag(596444241,o.logCategory.WopiPendingApplication,o.logLevel.Info,"Initializing Office frame");var t=e.buildApplicationBootUrl(this.appParams,this.wopiFallbackInfo,!0),i=e.buildWacFramePostData(this.appParams);if(this.wopiFallbackInfo.ignoreWacFramePostMessages||this.populateWacFrameCompletedAndFailedHandlers(),this.bootWacFrame(t,i),this.wopiFallbackInfo.ignoreWacFramePostMessages){var n=this.getApplicationState();this.fnOnWopiBootSuccess(n)}return this.innerApplicationFrame},e.prototype.bootWacFrame=function(e,t){this.appInitDiagnostics.officeFrameCreateTime=Date.now(),this.sessionTraces.add("frameCreateStartTime",this.appInitDiagnostics.officeFrameCreateTime);var i=!(!this.appParams.sessionInformation.WdParams||!this.appParams.sessionInformation.WdParams.wdSandboxWacFrame),o=this.appParams.applicationCustomSettings&&this.appParams.applicationCustomSettings.appFrameName;this.appParams.fnCreatePragueFrame?this.innerApplicationFrame=this.appParams.fnCreatePragueFrame(this.appParams):this.innerApplicationFrame=s.OfficeFrameUtils.createAndSubmitWacFrame(this.appParams.container,e,t,i,o)},e.prototype.populateWacFrameCompletedAndFailedHandlers=function(){var e=this;this.postMessenger.RegisterMessagePayloadHandler(s.OfficeFrameUtils.fromWacFrameAppCompleted,function(t){e.handleWacCompleteMessage(t)}),this.postMessenger.RegisterMessagePayloadHandler(s.OfficeFrameUtils.fromWacFrameAppFailed,function(t){e.handleWacFailureMessage(t)}),window.setTimeout(function(){return e.timeoutWacAppCompleteOrFail()},s.OfficeFrameUtils.wacAppCompleteOrFailTimeoutInMs)},e.prototype.handleWacCompleteMessage=function(e){if(this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444234,o.logCategory.WopiPendingApplication,o.logLevel.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(s.OfficeFrameUtils.fromWacFrameAppCompletedAck,{}),n.DiagnosticsHelper.assembleFromMessagePayload(e,this.appInitDiagnostics),this.logger.ULS.traceTag(595986314,o.logCategory.WopiPendingApplication,o.logLevel.Info,"Received wac complete message");var t=this.getApplicationState();this.fnOnWopiBootSuccess(t),this.sendJsApiDiagnosticsToWacFrame(this.appParams.diagnostics),this.logger.ULS.flush()}},e.prototype.getApplicationState=function(){return{innerApplicationFrame:this.innerApplicationFrame}},e.prototype.handleWacFailureMessage=function(e){if(this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444235,o.logCategory.WopiPendingApplication,o.logLevel.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(s.OfficeFrameUtils.fromWacFrameAppFailedAck,{});var t={errorType:c.ApplicationErrors.WacFailed,errorObject:{}};e&&(t.errorObject=e.Error,this.sessionTraces.add("error",t)),this.logger.ULS.traceTag(595986315,o.logCategory.WopiPendingApplication,o.logLevel.Error,"Received wac failed message"),this.fnOnWopiBootFailure(t),this.logger.ULS.flush()}},e.prototype.timeoutWacAppCompleteOrFail=function(){this.wacAppCompleteOrFailReceived||this.logger.ULS.traceTag(596444236,o.logCategory.WopiPendingApplication,o.logLevel.Warning,"WopiPendingApplication.timeoutWacAppCompleteOrFail() sessionTraces:"+JSON.stringify(this.sessionTraces))},e.prototype.sendJsApiDiagnosticsToWacFrame=function(e){this.sendWacPostMessage(s.OfficeFrameUtils.toWacFrameJsApiDiagnostics,e)},e.buildWacFramePostData=function(t){var i={};if(t.wopiInfo&&(i[s.OfficeFrameUtils.wacFrameAccessToken]=t.wopiInfo.AccessToken,i[s.OfficeFrameUtils.wacFrameAccessTokenTtl]=e.getAccessTokenTtl(t.wopiInfo)),t.wopiPrecheckInfo.BundleInfo&&t.wopiPrecheckInfo.BundleInfo.Url&&t.wopiPrecheckInfo.BundleInfo.Url.length>0&&(i[s.OfficeFrameUtils.wacFrameBundleSource]=t.wopiPrecheckInfo.BundleInfo.Url),t.wopiPrecheckInfo.FileGetUrl&&(i[s.OfficeFrameUtils.wacFrameFileGetUrl]=t.wopiPrecheckInfo.FileGetUrl),t.wopiPrecheckInfo.FileName){var o=t.wopiPrecheckInfo.FileName.lastIndexOf(".");if(-1!==o){var n=t.wopiPrecheckInfo.FileName.substring(o+1);n&&(i[s.OfficeFrameUtils.wacFrameFileExtension]=n)}}t.sessionInformation.UserId&&(i[s.OfficeFrameUtils.wacFrameUserId]=t.sessionInformation.UserId),t.sessionInformation.OwnerId&&(i[s.OfficeFrameUtils.wacFrameOwnerId]=t.sessionInformation.OwnerId),t.sessionInformation.SessionContext&&(i[s.OfficeFrameUtils.wacFrameSessionContext]=t.sessionInformation.SessionContext),t.diagnostics&&(i[s.OfficeFrameUtils.wacFrameHostDiagnostics]=JSON.stringify(t.diagnostics)),i[s.OfficeFrameUtils.wacFrameHighDpi]=String(window.devicePixelRatio>1.24);var a=p.JoinAppFlights(t);return a.length>0&&(i[s.OfficeFrameUtils.wacFrameHostFlights]=a),i},e.getAccessTokenTtl=function(e){return e.AccessTokenExpiry?e.AccessTokenExpiry.getTime().toString():"0"},e.buildApplicationBootUrl=function(e,t,i){void 0===i&&(i=!1);var o=t.required?t.applicationUrl:e.applicationUrl;if(o=r.WopiUtils.transformApplicationUrl(o,e.sessionInformation,e.wopiInfo,e.diagnostics.HostInitializeDiagnostics),o=a.UrlUtils.addQueryParam(o,"jsApi","1"),i&&(o=a.UrlUtils.addQueryParam(o,"NewSession","1")),o=a.UrlUtils.addQueryParam(o,"corrid",e.sessionId),o=a.UrlUtils.addQueryParam(o,"usid",e.sessionId),e.applicationCustomSettings&&e.applicationCustomSettings.IsCore&&(o=a.UrlUtils.addQueryParam(o,"core","1"),e.sessionInformation.DisableFocusOnBoot&&(o=a.UrlUtils.addQueryParam(o,"disableFocusOnBoot","1"))),e.applicationCustomSettings&&e.applicationCustomSettings.FixDiagnosticsJson&&(o=a.UrlUtils.addQueryParam(o,"fixdiag","1")),e.wopiPrecheckInfo.ReadOnly&&(o=a.UrlUtils.addQueryParam(o,"readOnly","1")),e.applicationCustomSettings&&e.applicationCustomSettings.InAppDocumentPreview&&(o=a.UrlUtils.addQueryParam(o,"InAppDocPreview","1")),t.required?(t.singleFlushFallback&&(e.isCreateNew||(o=a.UrlUtils.addQueryParam(o,"instantedit","1"),o=a.UrlUtils.addQueryParam(o,"wopicomplete","1"))),o=a.UrlUtils.addQueryParam(o,"wdRedirectionReason",t.reason)):(o=a.UrlUtils.addQueryParam(o,"instantedit","1"),o=a.UrlUtils.addQueryParam(o,"fileSrc",encodeURIComponent(e.sessionInformation.HostName)),o=a.UrlUtils.addQueryParam(o,"pmOrigin",encodeURIComponent(a.UrlUtils.getOrigin(window.location.href))),e.isCreateNew&&(o=a.UrlUtils.addQueryParam(o,"new","1"),e.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(o=a.UrlUtils.addQueryParam(o,"wdTpl","fromhost")))),e.applicationCustomSettings&&e.applicationCustomSettings.additionalApplicationParameters)for(var n in e.applicationCustomSettings.additionalApplicationParameters){var s=e.applicationCustomSettings.additionalApplicationParameters[n];o=a.UrlUtils.addQueryParam(o,n,s)}return o},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow?this.postMessenger.SendPostMessage(this.innerApplicationFrame.contentWindow,e,t):this.logger.ULS.traceTag(595955718,o.logCategory.WopiPendingApplication,o.logLevel.Info,"Attempted to send postmessage: "+e)},e}();t.WopiApplicationInitializer=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),n=function(){function e(){}return e.setPlaceholderValue=function(e,t,i){var n=e,a=new RegExp("<"+t+"=([A-Z_]+)(&?)>").exec(n);if(a&&a[0]){var r=a.length>=2&&a[2]?a[2]:"",s=i?t+"="+i+r:"";n=n.substring(0,a.index)+s+n.substring(a.index+a[0].length)}else n=o.UrlUtils.addQueryParam(n,t,i);return n},e.setWopiPlaceholdersOnApplicationUrl=function(e,t){var i=e;i=this.setPlaceholderValue(i,"ui",t.UiLocale?t.UiLocale:""),i=this.setPlaceholderValue(i,"rs",t.DataLocale?t.DataLocale:""),i=this.setPlaceholderValue(i,"hid",t.HostSessionId?t.HostSessionId:""),i=this.setPlaceholderValue(i,"dchat",t.DisableChat?"true":""),i=this.setPlaceholderValue(i,"sc",t.SessionContext?t.SessionContext:"");var o=new RegExp(/<.*?>/g);return i=i.replace(o,"")},e.setWdParamsOnApplicationUrl=function(e,t){var i=e;if(t.WdParams)for(var n in t.WdParams)i=o.UrlUtils.addQueryParam(i,n,t.WdParams[n]);return i},e.transformApplicationUrl=function(e,t,i,n){var a=e;return a=this.setWopiPlaceholdersOnApplicationUrl(a,t),a=this.setWdParamsOnApplicationUrl(a,t),i&&i.WopiSrc&&(a=o.UrlUtils.addQueryParam(a,"WOPISrc",encodeURIComponent(i.WopiSrc))),t.CookieCompliant&&(a=o.UrlUtils.addQueryParam(a,"mscc","1")),n&&(n.entryPoint&&(a=o.UrlUtils.addQueryParam(a,this.wopiSessionOrigin,encodeURI(n.entryPoint))),n.userClickTime&&(a=o.UrlUtils.addQueryParam(a,this.wopiHostClickTime,n.userClickTime.toString()))),a},e.wopiSessionOrigin="wdOrigin",e.wopiHostClickTime="wdHostClickTime",e}();t.WopiUtils=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JoinAppFlights=function(e){var t="";return null!=e.flights&&e.flights.forEach(function(e){if(e.shouldPassStatusToWacFrame){var i="None";e.IsFlightEnabled()?i="Treatment":e.IsFlightControl()&&(i="Control"),t+=e.name+"_"+i+";"}}),t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(1),n=i(25),a=i(26),r=i(8),s=i(3),l=function(){function e(e,t,i,o,n,a,s,l,c){this.wacCompleteMessageReceived=!1,this.appInitializeComplete=!1,this.isMobile=!1,this.appInitializeTimeoutInMs=6e4,this.appParams=e,this.wopiFallbackInfo=t,this.appInitDiagnostics=i,this.logger=o,this.postMessenger=n,this.visibilityMetrics=a,this.sessionTraces=s;var p=window.navigator.userAgent;p.indexOf("Mobi")>=0&&p.indexOf("iPad")<0&&(this.isMobile=!0),this.fnOnWopiBootSuccess=l,this.fnOnWopiBootFailure=c,this.fnOnWopiBootSuccessProxy=this.isMobile?l:this.getSuccessCallbackProxy(),this.fnOnWopiBootFailureProxy=this.isMobile?c:this.getFailureCallbackProxy(),this.isCore=!(!this.appParams.applicationCustomSettings||!this.appParams.applicationCustomSettings.IsCore),this.appParams.sessionInformation&&this.appParams.sessionInformation.WdParams&&(this.appParams.applicationCustomSettings&&this.appParams.applicationCustomSettings.ForceAccessibilityMode?this.appParams.sessionInformation.WdParams.wdAccPdf="1":this.isCore&&(this.appParams.sessionInformation.WdParams.wdAccPdf="0")),this.wopiPendingInitializer=new r.WopiPendingApplicationInitializer(this.appParams,t,i,o,n,a,s,this.fnOnWopiBootSuccessProxy,this.fnOnWopiBootFailureProxy)}return e.prototype.Complete=function(e){this.appParams.diagnostics.HostInitializeDiagnostics&&(this.appParams.diagnostics.HostInitializeDiagnostics.hostCompleteCallTime=Date.now()),this.wopiPendingInitializer.Complete(e)},e.prototype.Fail=function(e){this.wopiPendingInitializer.Fail(e)},e.prototype.Boot=function(){var e=this;this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),this.visibilityMetrics.RegisterEventHandler(this.visibilityChangeHandler),this.isMobile?this.logger.ULS.traceTag(595932544,o.logCategory.WordViewer,o.logLevel.Info,"Mobile Endpoint detected, skipping first page viewer optimization"):(this.logger.ULS.traceTag(595989253,o.logCategory.WordViewer,o.logLevel.Info,"Boot WordViewer"),this.postMessenger.RegisterMessagePayloadHandler(a.PostMessageIds.UpdatePageCount,function(t){e.handleWacPageCountInit(t)}),this.postMessenger.RegisterMessagePayloadHandler(n.ApplicationEvents.PageChanged,function(t){e.handleWacCurrentPageInit(t)}),this.postMessenger.RegisterMessagePayloadHandler(n.ApplicationEvents.ZoomChanged,function(t){e.handleWacZoomLevelInit(t)}),this.appParams.wopiPrecheckInfo.BundleInfo?this.kickOffFirstPageOptimization(this.appParams.wopiPrecheckInfo.BundleInfo,this.appParams.container,function(){e.firstPageOptimizationLoadTime=Date.now(),e.logger.ULS.traceTag(595998873,o.logCategory.WordViewer,o.logLevel.Info,"FirstPageFromHostLoadTime: "+e.firstPageOptimizationLoadTime),e.appInitDiagnostics.documentLoadedTime=e.appInitDiagnostics.documentLoadedTime||e.firstPageOptimizationLoadTime,e.innerApplicationFrame&&e.innerApplicationFrame.contentWindow&&e.PostFastBootOptimizationTime(e.innerApplicationFrame.contentWindow,e.firstPageOptimizationLoadTime)},function(t){e.removeFirstPageContainer(),e.logger.ULS.traceTag(595994571,o.logCategory.WordViewer,o.logLevel.Warning,"Cannot load first page from cache"),e.appInitDiagnostics.errorObject=t}):this.logger.ULS.traceTag(596121033,o.logCategory.WordViewer,o.logLevel.Warning,"Missing Bundle Info"),window.setTimeout(function(){return e.timeoutAppInitialize()},this.appInitializeTimeoutInMs))},e.prototype.PostFastBootOptimizationTime=function(e,t){this.postMessenger.SendPostMessage(e,a.PostMessageIds.HostCacheDiagnostic,{HostCacheLoadTime:t})},e.prototype.kickOffFirstPageOptimization=function(e,t,i,n){var a=this;if(this.logger.ULS.traceTag(595989254,o.logCategory.WordViewer,o.logLevel.Info,"Kick off OptimizationView"),!this.appParams.applicationCustomSettings||!this.appParams.applicationCustomSettings.ForceAccessibilityMode){var r=t.ownerDocument;this.firstPageContainer=r.createElement("div"),this.firstPageContainer.id="FirstPageContainer",this.firstPageContainer.style.left="0",this.firstPageContainer.style.textAlign="center",this.firstPageContainer.style.width="1px",this.firstPageContainer.style.bottom="0",this.firstPageContainer.style.zIndex="900",this.firstPageContainer.style.height="1px",this.firstPageContainer.style.position="absolute",this.firstPageContainer.style.padding="0 29px",this.firstPageContainer.style.right="0",this.firstPageContainer.style.overflow="auto",this.firstPageContainer.style.marginLeft="auto",this.firstPageContainer.style.marginRight="auto",this.firstPageContainer.style.maxWidth="100%",this.isCore?this.firstPageContainer.style.top="0":this.firstPageContainer.style.top="90px",t.appendChild(this.firstPageContainer);var l=r.createElement("img");l.id="FirstPageImage",l.style.marginTop="11px",l.style.marginBottom="11px",l.style.maxWidth="100%",l.style.border="solid 1px #d2d5d8",l.draggable=!1,l.onload=function(){a.logger.ULS.traceTag(595989255,o.logCategory.WordViewer,o.logLevel.Info,"OptimizationView Loaded"),a.firstPageContainer.style.width="",a.firstPageContainer.style.height="",i()},l.onerror=function(e){n({errorType:s.ApplicationErrors.CannotLoadFirstPage,errorObject:e.returnValue})},l.src=e.Url.replace("{0}","p1.img"),this.firstPageContainer.appendChild(l)}},e.prototype.tryInitializeApplication=function(){if(!this.appInitializeComplete&&this.wacCompleteMessageReceived&&(!this.isCore||this.currentPage&&this.pageCount&&this.zoomLevel)){this.postMessenger.RemoveMessageHandler(a.PostMessageIds.UpdatePageCount),this.postMessenger.RemoveMessageHandler(n.ApplicationEvents.PageChanged),this.postMessenger.RemoveMessageHandler(n.ApplicationEvents.ZoomChanged),this.visibilityMetrics.RemoveEventHandler(this.visibilityChangeHandler);var e={isCore:this.isCore,pageCount:this.pageCount,currentPage:this.currentPage,zoomLevel:this.zoomLevel,innerApplicationFrame:this.innerApplicationFrame};this.fnOnWopiBootSuccess(e),this.logger.ULS.traceTag(595989256,o.logCategory.WordViewer,o.logLevel.Info,"Word Viewer Initialize Complete"),this.appInitializeComplete=!0,this.logger.ULS.flush()}},e.prototype.getSuccessCallbackProxy=function(){var e=this;return function(t){e.logger.ULS.traceTag(595986312,o.logCategory.WordViewer,o.logLevel.Info,"SuccessCallbackProxy called"),e.innerApplicationFrame=t.innerApplicationFrame,e.innerApplicationFrame&&e.innerApplicationFrame.contentWindow&&e.firstPageOptimizationLoadTime&&e.PostFastBootOptimizationTime(e.innerApplicationFrame.contentWindow,e.firstPageOptimizationLoadTime),e.removeFirstPageContainer();var i=e.appInitDiagnostics.documentLoadedTime;i&&e.firstPageOptimizationLoadTime&&e.firstPageOptimizationLoadTime<i?(e.appInitDiagnostics.documentLoadedTime=e.firstPageOptimizationLoadTime,e.appInitDiagnostics.documentLoadedFromWopiPrecheckInfo=!0,e.logger.ULS.traceTag(595994572,o.logCategory.WordViewer,o.logLevel.Info,"First page load from cache was faster")):e.appInitDiagnostics.documentLoadedFromWopiPrecheckInfo=!1,e.sendAckMessages(),e.wacCompleteMessageReceived=!0,e.logger.ULS.traceTag(595986313,o.logCategory.WordViewer,o.logLevel.Info,"WordViewerInitializer received wac complete message"),e.tryInitializeApplication(),e.logger.ULS.flush()}},e.prototype.getFailureCallbackProxy=function(){var e=this;return function(t){e.logger.ULS.traceTag(595972122,o.logCategory.WordViewer,o.logLevel.Error,"FailureCallbackProxy called"),e.appInitializeComplete=!0,e.visibilityMetrics.RemoveEventHandler(e.visibilityChangeHandler),e.fnOnWopiBootFailure(t)}},e.prototype.removeFirstPageContainer=function(){this.firstPageContainer&&this.firstPageContainer.parentElement&&this.firstPageContainer.parentElement.removeChild(this.firstPageContainer)},e.prototype.timeoutAppInitialize=function(){if(!this.appInitializeComplete){this.sessionTraces.add("timeoutAppInitialize",Date.now());var e="Didn't receive app initialize post messages. {'appComplete': "+this.wacCompleteMessageReceived+", 'currentPage': "+(void 0!==this.currentPage)+", 'zoomLevel': "+(void 0!==this.zoomLevel)+", 'pageCount': "+(void 0!==this.pageCount)+"}";this.logger.ULS.traceTag(596120771,o.logCategory.WordViewer,o.logLevel.Warning,e)}},e.prototype.handleWacPageCountInit=function(e){if(!e||"number"!=typeof e[a.PostMessageFields.PageCount])throw new TypeError("values: PageCount not found");this.pageCount=e[a.PostMessageFields.PageCount],this.sendWacPostMessage(a.PostMessageIds.UpdatePageCountAck,{}),this.tryInitializeApplication()},e.prototype.handleWacCurrentPageInit=function(e){if(!e||"number"!=typeof e[a.PostMessageFields.NewPageNumber])throw new TypeError("values: CurrentPage not found");this.currentPage=e[a.PostMessageFields.NewPageNumber],this.sendWacPostMessage(a.PostMessageIds.PageChangedAck,{}),this.tryInitializeApplication()},e.prototype.handleWacZoomLevelInit=function(e){if(!e||"number"!=typeof e[a.PostMessageFields.NewZoomLevel])throw new TypeError("values: ZoomLevel not found");this.zoomLevel=e[a.PostMessageFields.NewZoomLevel],this.sendWacPostMessage(a.PostMessageIds.ZoomChangedAck,{}),this.tryInitializeApplication()},e.prototype.handleVisibilityChange=function(e){var t="Document visibility changed: "+e.visibility;this.logger.ULS.traceTag(595970189,o.logCategory.WordViewer,o.logLevel.Info,t)},e.prototype.sendAckMessages=function(){this.currentPage&&this.sendWacPostMessage(a.PostMessageIds.PageChangedAck,{}),this.pageCount&&this.sendWacPostMessage(a.PostMessageIds.UpdatePageCountAck,{}),this.zoomLevel&&this.sendWacPostMessage(a.PostMessageIds.ZoomChangedAck,{})},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow?this.postMessenger.SendPostMessage(this.innerApplicationFrame.contentWindow,e,t):this.logger.ULS.traceTag(595955717,o.logCategory.WordViewer,o.logLevel.Info,"Attempted to send WordViewer postmessage: "+e)},e}();t.WordViewerInitializer=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return Object.defineProperty(e,"BrowserEvent",{get:function(){return"BrowserEvent"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PageChanged",{get:function(){return"PageChanged"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ZoomChanged",{get:function(){return"ZoomChanged"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ContentRefreshBegin",{get:function(){return"ContentRefreshBegin"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ContentRefreshEnd",{get:function(){return"ContentRefreshEnd"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AppClosed",{get:function(){return"UI_Close"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UserEdit",{get:function(){return"Edit_Notification"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FileRename",{get:function(){return"File_Rename"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FileShare",{get:function(){return"UI_Sharing"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowFileVersions",{get:function(){return"UI_FileVersions"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UIWorkflow",{get:function(){return"UI_Workflow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"IsDisabled",{get:function(){return"IsDisabled"},enumerable:!0,configurable:!0}),e}();t.ApplicationEvents=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return Object.defineProperty(e,"SetZoomLevel",{get:function(){return"SetZoomLevel"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SetCurrentPage",{get:function(){return"SetCurrentPage"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UpdatePageCount",{get:function(){return"PageCount"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FrameStateChanged",{get:function(){return"StateChanged"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ZoomChangedAck",{get:function(){return"ZoomChanged_Ack"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PageChangedAck",{get:function(){return"PageChanged_Ack"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UpdatePageCountAck",{get:function(){return"PageCount_Ack"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Error",{get:function(){return"Error"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HostCacheDiagnostic",{get:function(){return"HostCacheDiagnostic"},enumerable:!0,configurable:!0}),e}();t.PostMessageIds=o;var n=function(){function e(){}return Object.defineProperty(e,"NewZoomLevel",{get:function(){return"newLevel"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NewPageNumber",{get:function(){return"newPage"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PageCount",{get:function(){return"pageCount"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"IsDisabled",{get:function(){return"isDisabled"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ErrorType",{get:function(){return"errorType"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ErrorObject",{get:function(){return"errorObject"},enumerable:!0,configurable:!0}),e}();t.PostMessageFields=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(1),n=i(6),a=i(0),r=function(){function e(e,t){var i=this;if(this.eventHandlers={},!e)throw new Error("Missing origin for PostMessageHandler");this.logger=t,this.setOrigin(e),window.addEventListener("message",function(e){return i.handleWacFramePostMessage(e)},!1)}return e.prototype.RegisterMessagePayloadHandler=function(e,t){if(this.eventHandlers[e])throw new Error("Duplicate registration!");this.eventHandlers[e]=t},e.prototype.RemoveMessageHandler=function(e){delete this.eventHandlers[e]},e.prototype.SendPostMessage=function(e,t,i){if(e){this.logger.ULS.traceTag(596464334,o.logCategory.WopiPendingApplication,o.logLevel.Info,"PostMessageHandler - Sending message: "+t);var n={MessageId:t,SendTime:Date.now(),Values:i};this.sendPostMessageInternal(e,JSON.stringify(n),this.origin)}else this.logger.ULS.traceTag(595948308,o.logCategory.WopiPendingApplication,o.logLevel.Info,"Missing target for SendPostMessage")},e.prototype.Dispose=function(){delete this.eventHandlers},e.prototype.handleWacFramePostMessage=function(e){if(e.origin&&a.UrlUtils.getBaseDomain(e.origin,n.OfficeFrameUtils.subDomainPartsForPostMessageHandler).toLowerCase()===this.receivingDomain){var t;try{t=JSON.parse(e.data)}catch(e){return void this.logger.ULS.traceTag(596464282,o.logCategory.WopiPendingApplication,o.logLevel.Error,"PostMessageHandler - failed to parse event data: "+JSON.stringify(e))}var i=t.MessageId;if(i){i!==n.OfficeFrameUtils.fromWacFrameAppCompleted&&i!==n.OfficeFrameUtils.fromWacFrameAppLoadingStatus||this.setOrigin(e.origin);var r=this.eventHandlers[i];r?(this.logger.ULS.traceTag(596464288,o.logCategory.WopiPendingApplication,o.logLevel.Info,"PostMessageHandler - processing message: "+i),r(t.Values||{})):this.logger.ULS.traceTag(596464289,o.logCategory.WopiPendingApplication,o.logLevel.Info,"PostMessageHandler - no handler found for message id: "+i)}}},e.prototype.sendPostMessageInternal=function(e,t,i){e.postMessage(t,i)},e.prototype.setOrigin=function(e){this.origin&&this.origin!==e.toLowerCase()&&this.logger.ULS.traceTag(596128131,o.logCategory.WopiPendingApplication,o.logLevel.Warning,"PostMessageHandler - updating origin on receiving message: "),this.origin=e.toLowerCase(),this.receivingDomain=a.UrlUtils.getBaseDomain(e,n.OfficeFrameUtils.subDomainPartsForPostMessageHandler).toLowerCase()},e}();t.PostMessageHandler=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityChangeEvents=[];var o=function(){function e(){this.eventHandlers=[],this.initialize()}return e.prototype.initialize=function(){if("hidden"===document.visibilityState){var e={visibility:document.visibilityState,time:Date.now(),initialState:!0};t.VisibilityChangeEvents.push(e)}this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.visibilityChangeHandler)},e.prototype.RegisterEventHandler=function(e){this.eventHandlers.push(e)},e.prototype.RemoveEventHandler=function(e){if(e){var t=this.eventHandlers.indexOf(e);this.eventHandlers.splice(t,1)}},e.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},e.prototype.GetVisibilityChangeEvents=function(){return t.VisibilityChangeEvents},e.prototype.handleVisibilityChange=function(){var e={visibility:document.visibilityState,time:Date.now(),initialState:!1};t.VisibilityChangeEvents.push(e);for(var i=0,o=this.eventHandlers;i<o.length;i++){var n=o[i];n&&n(e)}},e}();t.WindowVisibilityMetrics=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(30),n=i(0),a=i(4),r=i(5),s=i(11);function l(e,t){return t||"1"===n.UrlUtils.getParameterValue(e,"new")}function c(e){return e.indexOf("we/wordeditorframe.aspx")>=0}function p(e){return e.indexOf("wv/wordviewerframe.aspx")>=0}function g(e,t){e.WdParams||(e.WdParams={}),t.substring(1).split("&").filter(function(t){if(0===t.indexOf("wd")){var i=t.split("=");e.WdParams[i[0]]=i[1]}})}t.getApplicationParameters=function(e,t){return{container:e.Container,sessionInformation:function(e){return g(e,window.location.search),e}(e.SessionInformation),applicationUrl:e.ApplicationUrl,wopiPrecheckInfo:e.WopiPrecheckInfo,applicationCustomSettings:e.ApplicationCustomSettings,diagnostics:{HostInitializeDiagnostics:e.Diagnostics,JsApiDiagnostics:{}},fnOnInitializeSuccess:e.FnOnInitializeSuccess,fnOnInitializeFailure:e.FnOnInitializeFailure,applicationFiles:new o.ApplicationFiles(e.ApplicationCustomSettings&&e.ApplicationCustomSettings.appBundleParameters,e.BootstrapperUrl),sessionId:t,applicationBaseUrl:n.UrlUtils.getApplicationBaseUrl(e.ApplicationUrl),wopiInfo:e.WopiInfo,forceFallback:!1,disableFallback:!1,isCreateNew:l(e.ApplicationUrl,e.WopiPrecheckInfo.IsNewFile),flights:[]}},t.newGuid=function(){var e=new Uint8Array(31),t=function(e){var t={crypto:!1,perfNow:!1,exceptions:[]},i=window.crypto||window.msCrypto;if(i){t.crypto=!0;try{return i.getRandomValues(e),t}catch(e){t.exceptions.push("crypto: "+JSON.stringify(e))}}var o=!1,n=window.performance;try{n&&n.now&&n.now()!==1/0&&(o=!0)}catch(e){t.exceptions.push("perfNow: "+JSON.stringify(e))}for(var a=0;a<e.length;a+=1){try{if(o){t.perfNow=!0;var r=Math.floor(100*n.now())%10;(r<0||r>9)&&(r=0);for(var s=0;s<r;s+=1)Math.random()}}catch(e){t.exceptions.push("Math.random: "+JSON.stringify(e))}e[a]=Math.floor(16*Math.random())}return t}(e),i=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=15&e[i];return i+=1,("x"===t?o:3&o|8).toString(16)}),t]},t.isCreateNew=l,t.isUrlForWordEditAction=c,t.isUrlForWordViewAction=p,t.getWopiFallbackInfo=function(e,t){var i=e.applicationUrl.toLowerCase(),o=c(i),n=p(i),l=function(e,t,i){if(e.forceFallback)return{required:!0,applicationUrl:e.applicationUrl,forceFallback:!0,reason:s.FallbackOptions.forceFallback,ignoreWacFramePostMessages:!1};var o={required:!1,applicationUrl:"",reason:"",ignoreWacFramePostMessages:!1,forceFallback:!1,singleFlushFallback:!1};return e.disableFallback?o:t||!0!==e.wopiPrecheckInfo.IrmEnabled?e.fnCreatePragueFrame?(o.required=!0,o.singleFlushFallback=!0,o.reason=s.FallbackOptions.unifiedSingleFlushFallback,o.applicationUrl=e.applicationUrl,o.ignoreWacFramePostMessages=!1,o):(t?e.wopiInfo&&(o.required=!0,o.singleFlushFallback=!0,o.reason=s.FallbackOptions.unifiedSingleFlushFallback,o.applicationUrl=e.applicationUrl,o.ignoreWacFramePostMessages=e.isCreateNew||!1):(o.required=!0,o.ignoreWacFramePostMessages=!0,o.reason=i?s.FallbackOptions.unifiedViewActionUrlFallback:s.FallbackOptions.unifiedNotEditOrViewActionUrlFallback,o.applicationUrl=e.applicationUrl),o):(o.required=!0,o.irmFallback=!0,o.ignoreWacFramePostMessages=!0,o.reason=s.FallbackOptions.unifiedIrmEnabledFallback,o.applicationUrl=e.applicationUrl,o)}(e,o,n);if(l.required){var g={fallbackIsRequired:!0,fallbackReason:l.reason,gotWordEditUrl:o,gotWordViewUrl:n,irmEnabled:e.wopiPrecheckInfo.IrmEnabled,readOnly:e.wopiPrecheckInfo.ReadOnly};t.ULS.traceTag(596444182,a.logCategory.WopiPendingApplication,g.irmEnabled?r.logLevel.Warning:r.logLevel.Info,JSON.stringify(g))}else t.ULS.traceTag(596444183,a.logCategory.WopiPendingApplication,r.logLevel.Info,"Received input valid for instant boot.");return l},t.setWdParams=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(31),n=i(10),a=function(){function e(e,t){this.forceShip=e&&e.forceShip,this.appBundleUrl=this.getBaseUrl(t,e&&e.appBundleCustomUrl)}return e.prototype.getBaseUrl=function(t,i){if(void 0!==i)return i;if(void 0!==t){var n=e.getHost(t);if(n)return o.ApplicationRoot.baseUrl(n)}return o.ApplicationRoot.defaultBaseUrl},Object.defineProperty(e.prototype,"baseUrl",{get:function(){return this.appBundleUrl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"prefetchJsPaths",{get:function(){var e=["app_scripts/microsoftajax"+this.getDebugSuffix()+".js","app_scripts/wordinstantviewer"+this.getDebugSuffix()+".js","app_scripts/wordinstantviewer"+this.getDebugSuffix()+".dll1.js"];return-1===navigator.userAgent.indexOf("Trident")&&-1===navigator.userAgent.indexOf("IEMobile")&&e.push("app_scripts/compat"+this.getDebugSuffix()+".js"),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cssPaths",{get:function(){return["resources/1033/wordviewer.css"]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preReqJsPaths",{get:function(){var e=["app_scripts/microsoftajax"+this.getDebugSuffix()+".js"];return-1===navigator.userAgent.indexOf("Trident")&&-1===navigator.userAgent.indexOf("IEMobile")&&e.push("app_scripts/compat"+this.getDebugSuffix()+".js"),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appJsPaths",{get:function(){return["app_scripts/wordinstantviewer"+this.getDebugSuffix()+".js"]},enumerable:!0,configurable:!0}),e.prototype.getDebugSuffix=function(){return n.DebugConfig.DEBUG_SUFFIX&&!this.forceShip?n.DebugConfig.DEBUG_SUFFIX:""},e.getHost=function(e){var t=e.match(/^(https?\:\/\/[^\/?#]+)(?:[\/?#]|$)/i);return t&&t[1]?t[1]:""},e}();t.ApplicationFiles=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(2),n=function(){function e(){}return Object.defineProperty(e,"defaultBaseUrl",{get:function(){throw"BootstrapperUrl has to be provided for Instant Viewer to work from WAC CDN"},enumerable:!0,configurable:!0}),e.baseUrl=function(t){return t+"/wv/s/"+e.contentVersion+"_"},Object.defineProperty(e,"contentVersion",{get:function(){var e=o.BuildVersionConfig.BUILD_NUMBER;return e.substr(0,2)+e.substr(5,5)+e.substr(11,5)},enumerable:!0,configurable:!0}),e}();t.ApplicationRoot=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(13),n=i(33);t.FlightList=o.ExcelFlightsList.concat(n.WordFlightsList)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(14);t.WordFlightsList=[new o.Flight("WordEditorPreloadResources",.1)]},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(2),n=function(){function e(e,t,i,o){this.sessionId=e,this.logger=t,this.innerApplicationFrame=o.innerApplicationFrame,this.postMessenger=i}return e.prototype.GetApplicationType=function(){throw new Error("Not implemented")},e.prototype.GetVersion=function(){return o.BuildVersionConfig.BUILD_NUMBER},e.prototype.GetSessionId=function(){return this.sessionId},e.prototype.RegisterEventHandler=function(e,t){this.postMessenger.RegisterMessagePayloadHandler(e,t)},e.prototype.RemoveEventHandler=function(e,t){this.postMessenger.RemoveMessageHandler(e)},e.prototype.RegisterErrorHandler=function(e){},e.prototype.RemoveErrorHandler=function(e){},e.prototype.Dispose=function(){this.logger&&this.logger.ULS.flushOnClose(),this.innerApplicationFrame&&this.innerApplicationFrame.parentElement&&this.innerApplicationFrame.parentElement.removeChild(this.innerApplicationFrame),delete this.innerApplicationFrame},e}();t.Application=n,t.ApplicationFactory=function(e,t,i,o){return new n(e,t,i,o)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(36),n=function(){function e(){}return e.prototype.shouldPreload=function(e){return this.isExcelsUrl(e)},e.prototype.preload=function(e){new o.ExcelResources(e).preloadResources()},e.prototype.isExcelsUrl=function(e){return e.indexOf("xlviewerinternal.aspx")>=0},e}();t.ExcelPreloader=n},function(e,t,i){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=i(37),a=i(12),r=function(e){function t(t){var i=e.call(this,t)||this;return i.resources=[],i.initResources(),i}return o(t,e),t.prototype.initResources=function(){var e;(e=a.FlightManager.Instance().IsFlightEnabled("ExcelEwaBootScript")?[{domain:"excel",url:"Ewa"+this.debugSuffix+".boot.js",localized:!1,type:"script"}]:[{domain:"excel",url:"Ewa"+this.debugSuffix+".js",localized:!1,type:"script"}]).push({domain:"excel",url:"Aacorlib.js",localized:!1,type:"script"}),e.push({domain:"excel",url:"Ewa.Strings.Wac"+this.debugSuffix+".js",localized:!0,type:"script"}),e.push({domain:"excel",url:"EwrDefaultM2.css",localized:!0,type:"css"}),e.push({domain:"excel",url:"excelframe.css",localized:!0,type:"css"}),a.FlightManager.Instance().IsFlightEnabled("ExcelGridRendererDownload")&&e.push({domain:"excel",url:"gridRenderer"+this.minSuffix+".js",localized:!1,type:"script"});for(var t=0,i=e;t<i.length;t++){var o=i[t],n=this.resourceHostUrl;"/"!==n[n.length-1]&&(n+="/");var r="App_Scripts";"css"===o.type&&(r="Resources");var s="";o.localized&&(s="1033/"),n+="x/s/"+this.buildPrefix+"__layouts/"+r+"/"+s+o.url,this.resources.push(n)}},t}(n.StaticResources);t.ExcelResources=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(2),n=i(10),a=i(0),r=function(){function e(t){this.resourceHostUrl=a.UrlUtils.getOrigin(t),this.buildPrefix=e.getContentVersion(),this.debugSuffix=e.getDebugSuffix(),this.minSuffix=e.getMinSuffix()}return e.prototype.preloadResources=function(){for(var t=0,i=this.resources;t<i.length;t++){var o=i[t];e.preloadResource(o)}},e.preloadResource=function(e){var t=document.createElement("link");t.setAttribute("crossorigin","anonymous"),t.rel="preload",t.href=e,t.setAttribute("as","script"),document.head.appendChild(t)},e.getContentVersion=function(){var e=o.BuildVersionConfig.BUILD_NUMBER;if(n.DebugConfig.IS_DEBUG)return e;if(!e)throw new Error("Build number not available");var t=e.split(".");if(4!==t.length)throw new Error("Build number has incorrect format");return t[0]+t[2]+t[3]},e.getDebugSuffix=function(){return n.DebugConfig.DEBUG_SUFFIX?n.DebugConfig.DEBUG_SUFFIX:""},e.getMinSuffix=function(){return n.DebugConfig.MIN_SUFFIX?n.DebugConfig.MIN_SUFFIX:""},e}();t.StaticResources=r}]);
