Type.registerNamespace("Common.App.Policy.Contracts");Common.App.Policy.Contracts.a=function(){};Common.App.Policy.Contracts.a.registerInterface("Common.App.Policy.Contracts.a");Common.App.Policy.Contracts.e=function(n,t,i,r){Common.App.Policy.Contracts.e.initializeBase(this);this.d=n;this.c=t;this.b=i;this.a=r};Common.App.Policy.Contracts.e.prototype={c:null,d:null,b:null,a:null};Common.App.Policy.Contracts.d=function(){Common.App.Policy.Contracts.d.initializeBase(this)};Common.App.Policy.Contracts.f=function(){Common.App.Policy.Contracts.f.initializeBase(this)};Common.App.Policy.Contracts.b=function(){Common.App.Policy.Contracts.b.initializeBase(this)};Common.App.Policy.Contracts.b.prototype={a:!1};Common.App.Policy.Contracts.c=function(){this.IsLabelAvailable=!1;this.DisplayName="";this.LabelDescription="";this.ShouldBeEncrypted=!1;this.ShouldApplyWatermark=!1;this.HeaderData="";this.FooterData="";this.PolicyTipText="";this.NavigateUrl=""};Common.App.Policy.Contracts.c.prototype={IsLabelAvailable:!1,DisplayName:null,LabelDescription:null,ShouldBeEncrypted:!1,ShouldApplyWatermark:!1,HeaderData:null,FooterData:null,PolicyTipText:null,NavigateUrl:null};Common.App.Policy.Contracts.e.registerClass("Common.App.Policy.Contracts.e",Sys.EventArgs);Common.App.Policy.Contracts.d.registerClass("Common.App.Policy.Contracts.d",Sys.EventArgs);Common.App.Policy.Contracts.f.registerClass("Common.App.Policy.Contracts.f",Sys.EventArgs);Common.App.Policy.Contracts.b.registerClass("Common.App.Policy.Contracts.b",Sys.EventArgs);Common.App.Policy.Contracts.c.registerClass("Common.App.Policy.Contracts.c");Type.registerNamespace("Common.App.Policy");Common.App.Policy.d=function(n,t,i){this.IsPolicyTipAvailable=n;this.GeneralText=t;this.NavigateUrl=i};Common.App.Policy.a=function(n,t,i,r){this.h=Function.createDelegate(this,this.j);this.g=Function.createDelegate(this,this.i);this.a=n;this.d=t;this.e=r;i.a("SupportsPolicies")&&i.c("AppliedPolicyId")&&(this.c=i.c("IrmPolicyTitle"),this.b=i.c("IrmPolicyDescription"));this.f=i.a("ProtectedFile")};Common.App.Policy.a.prototype={a:null,d:null,e:null,c:null,b:null,f:!1,k:function(){this.a.a(3427834559,2147483648,this.g);this.a.d(497870830,2147483648,this.h,96);this.d.r(!1)},i:function(n,t,i){return i===1?32:(i===2,32)},j:function(n,t,i,r,u){if(i===1)return 32;var e=this.e.a().d(),f=u;if(e.DisplayName)f.LabelText=e.DisplayName,e.LabelDescription&&(f.Alt=e.LabelDescription);else{if(!this.c)return 32;f.LabelText=this.c;this.b&&(f.Alt=this.b)}return f.Image16by16=Common.a.q,f.Image16by16Class=this.f?Common.A.b("ProtectForm14"):Common.A.b("MarkAsProtected14"),f.Visible=!0,32}};Common.App.Policy.b=function(n,t,i){this.t=Function.createDelegate(this,this.G);this.q=Function.createDelegate(this,this.D);this.s=Function.createDelegate(this,this.F);this.u=Function.createDelegate(this,this.H);this.r=Function.createDelegate(this,this.E);this.v=Function.createDelegate(this,this.I);this.g=new Common.M;this.j=n;this.f=t;this.p=i;this.n=new Common.App.Policy.Contracts.c};Common.App.Policy.b.prototype={k:null,o:null,j:null,p:0,m:0,l:0,n:null,f:null,h:null,e:null,i:null,a:function(n){this.g.n("PolicyTipEvent",n)},c:function(n){this.g.n("LabelInfoUpdateEvent",n)},w:function(n){var t=Common.a.b().a().i();return String.format("{0}{1}?action={2}&{3}",t,"PolicyHandler.ashx",n,Common.a.k)},b:function(){this.f&&(this.h=this.f.a("WebServiceCall","Call Policy Endpoint On Server"));this.j.a(this.w("datalosspolicy"),1,null,null,!0,2,this.v,this.r,null,null,!1,null,null,null,null,!1,null);this.m++;Diag.a.a(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.","PolicyHandler.ashx",this.m)},B:function(){this.f&&(this.e=this.f.a("WebServiceCall","Call Policy Endpoint On Server"));this.j.a(this.w("labelpolicy"),1,null,null,!0,2,this.u,this.s,null,null,!1,null,null,null,null,!1,null);this.l++;Diag.a.a(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.l)},d:function(){return this.n},H:function(n){this.e&&(this.e.a(),this.e=null);var t,i,r;(r=this.A(n,i={val:t}),t=i.val,r)&&(Diag.a.a(34996493,306,50,"Request to get label policy data succeeded."),this.K(t))},F:function(n){if(this.e&&(this.e.a(),this.e=null),this.l<=this.p){this.B();return}Diag.a.a(34996494,306,10,"Request to get label policy failed with error response: {0}.",n?n.b?n.b.i:null:null)},I:function(n){this.x();var t,i,r;(r=this.A(n,i={val:t}),t=i.val,r)&&(Diag.a.a(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.f&&(this.i=this.f.a("Task","Parse and Handle Policy Response")),this.J(t),this.i&&(this.i.a(),this.i=null))},E:function(n){if(this.x(),this.m<=this.p){this.b();return}Diag.a.a(25565154,306,10,"Request to get DataLossPrevention policy failed with error response: {0}.",n?n.b?n.b.i:null:null)},A:function(n,t){return(t.val=n?n.b?n.b.b:null:null,!t.val||!t.val.length||this.C(t.val))?(Diag.a.a(25565152,306,10,"No response data from policy endpoint."),!1):!0},J:function(n){var t;try{t=JSON.parse(n)}catch(i){Diag.a.a(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(!t){Diag.a.a(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.");return}if(!t.IsPolicyTipAvailable){Diag.a.a(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");return}switch(t.IsPolicyTipAvailable.toLowerCase()){case"false":Diag.a.a(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");return;case"true":Diag.a.a(25565186,306,50,"DLP Policy is enabled on this document.");this.k=t.NavigateUrl;this.z(t.GeneralText,this.q);break;default:Diag.a.a(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",t.IsPolicyTipAvailable)}},K:function(n){var t,f,e,i,r,o,u,s,h;if(!(e=Common.bw.a(Common.App.Policy.Contracts.c,n,f={val:t}),t=f.val,e)){Diag.a.a(34996495,306,10,"Error when deserializing label policy data response.");return}(this.n=t,t.DisplayName&&this.L(new Common.App.Policy.Contracts.d),t.IsLabelAvailable)&&(t.PolicyTipText&&(i=null,t.NavigateUrl&&(this.o=t.NavigateUrl,i=this.t),this.z(t.PolicyTipText,i)),t.HeaderData&&(o=(r=new Common.App.Policy.Contracts.b,r.a=!0,r),this.y(o)),t.FooterData&&(s=(u=new Common.App.Policy.Contracts.b,u.a=!1,u),this.y(s)),t.ShouldApplyWatermark&&(h=new Common.App.Policy.Contracts.f,this.M(h)))},L:function(n){Diag.a.a(35393610,306,50,"Raising label info update event.");this.g.m("LabelInfoUpdateEvent",n,null)},y:function(n){Diag.a.a(35393611,306,50,"Raising header/footer event.");this.g.m("HeaderFooterEvent",n,null)},M:function(n){Diag.a.a(35393612,306,50,"Raising watermark event.");this.g.m("WatermarkEvent",n,null)},z:function(n,t){Diag.a.a(34996496,306,50,"Showing policy tip to user.");this.g.m("PolicyTipEvent",new Common.App.Policy.Contracts.e($a.en,n,$a.eo,t),null)},D:function(){this.k?(Diag.a.a(25565187,306,50,"DLP override button was clicked."),Common.g.d(this.k)):Diag.a.a(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")},G:function(){this.o?(Diag.a.a(34996497,306,50,"CLP override button was clicked."),Common.g.d(this.o)):Diag.a.a(34996498,306,10,"Null NavigateUrl in CLP business bar when button clicked.")},C:function(n){return n.startsWith("<")&&(n.indexOf("Error")!==-1||n.indexOf("Unavailable")!==-1)?(Diag.a.a(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint."),!0):!1},x:function(){this.h&&(this.h.a(),this.h=null)}};Common.App.Policy.c=function(){this.h=Function.createDelegate(this,this.j);this.g=Function.createDelegate(this,this.i)};Common.App.Policy.c.a=function(){Common.App.a.a().a(new Common.App.Policy.c,0,!1)};Common.App.Policy.c.prototype={a:function(){return"Common.App.Policy"},d:null,e:null,f:null,b:function(){if(Common.a.a.a("ShouldInitCommonPolicyPackage")){if(Common.a.a.a("IsDataLossPreventionEnabledForUser")&&Common.a.b()){this.d=this.e.a(Common.App.Policy.Contracts.a);this.d.a(this.g);Diag.a.a(36537375,306,50,"PolicyManager is created successfully.");var n=this;Common.App.AppLifecycleManager.get_instance().a(6,function(){n.d.b()},3)}Common.a.a.a("WacLabelingPoliciesIsEnabled")&&(this.d||(this.d=this.e.a(Common.App.Policy.Contracts.a)),this.d.c(this.h),this.f=this.e.a(Common.App.Policy.a),this.f.k())}},c:function(n){var i=this,t;n.b(Common.App.Policy.Contracts.a).c(Common.App.Policy.Contracts.a).a().b(function(){return new Common.App.Policy.b(Common.a.d,Common.a.b().c(),Common.a.a.b("MaxGetPolicyRetries",1))});t=this;n.b(Common.App.Policy.a).c(Common.App.Policy.a).a().b(function(){return new Common.App.Policy.a(Common.a.c(),Common.a.b(),Common.a.a,n.e(Common.App.Policy.Contracts.a))});this.e=n},j:function(){Common.a.b().r(!1)},i:function(n,t){var i=new CommonUI.g(t.d,t.c,null),r;if(i.d(21),i.c(!0),t.a&&i.a(t.b,t.a,"",!1),r=Common.a.b().a(),!r.A(i,!0)){Diag.a.a(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.");return}Diag.a.a(34174785,306,50,"Add entry to BusinessBar succeeded. Policy message is shown to user.")}};Common.App.Policy.a.registerClass("Common.App.Policy.a");Common.App.Policy.c.a();Type.registerNamespace("_Ewa");_Ewa.PolicyManagerWrapper=function(n,t){this.k=Function.createDelegate(this,this.l);Diag.a.a(34402886,306,50,"DataLossPrevention feature is Enabled and launched on Excel.");this.e=n;this.j=t;this.e.a(this.k);this.e.b()};_Ewa.PolicyManagerWrapper.prototype={e:null,j:null,i:null,d:function(){return this.i},h:null,c:function(){return this.h},f:null,a:function(){return this.f},g:null,b:function(){return this.g},l:function(n,t){if(!t){Diag.a.a(34402887,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.");return}this.i=t.d;this.h=t.c;this.f=t.b;this.g=t.a;this.j.a(28,null);Diag.a.a(34402888,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")}};_Ewa.rq=function(n){_Ewa.rq.initializeBase(this);this.h=n;this.j()};_Ewa.rq.a=function(n){n.a().b(_Ewa.Lv.$$(_Ewa.hA),271,new _Ewa.rq(n))};_Ewa.rq.prototype={k:null,h:null,b:function(){var t=_Ewa.l.b(_Ewa.cj,this.h.a(),4,3),i=Common.a.d,n=this;_Ewa.f.cw(t,function(){try{n.i(n.k||(n.k=new _Ewa.PolicyManagerWrapper(new Common.App.Policy.b(i,Common.a.b().c(),n.h.f().MaxGetPolicyRetries),t.a())))}catch(r){Diag.a.a(36444224,306,10,"PolicyManager was not created successfully [Exception: {0}]",r.toString());throw r;}},this.cT(),3)}};_Ewa.PolicyManagerWrapper.registerClass("_Ewa.PolicyManagerWrapper",null,_Ewa.hA);_Ewa.rq.registerClass("_Ewa.rq",_Ewa.mu.$$(_Ewa.hA));Type.registerNamespace("_Ewa");_Ewa.MF=function(){};_Ewa.MF.a=function(){_Ewa.g.a(function(n){_Ewa.rq.a(n)})};_Ewa.MF.a();